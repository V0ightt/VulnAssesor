<tr class="scan-row"
    id="scan-{{ scan.id }}"
    {% if scan.status == 'PENDING' or scan.status == 'RUNNING' %}
    hx-get="{% url 'scan_status' scan.id %}"
    hx-trigger="every 3s"
    hx-swap="outerHTML swap:0.2s"
    {% endif %}
    style="transition: background-color 0.2s ease;">
    <td>
        <input
            type="checkbox"
            class="scan-checkbox"
            id="scan-checkbox-{{ scan.id }}"
            data-scan-id="{{ scan.id }}"
            onchange="toggleScanSelection({{ scan.id }})">
    </td>
    <td>
        <span class="scan-id">#{{ scan.id }}</span>
    </td>
    <td>
        <strong>{{ scan.website.name }}</strong>
        <br>
        <a href="{{ scan.website.url }}" target="_blank" rel="noopener noreferrer" class="scan-url">
            {{ scan.website.url }}
        </a>
    </td>
    <td>
        {% if scan.status == 'PENDING' %}
        <span class="status-badge status-pending">
            <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" stroke-width="4" stroke-dasharray="32" stroke-dashoffset="32">
                    <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
                </circle>
            </svg>
            Pending
        </span>
        {% elif scan.status == 'RUNNING' %}
        <span class="status-badge status-running">
            <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" stroke-width="4" stroke-dasharray="32" stroke-dashoffset="32">
                    <animateTransform attributeName="transform" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/>
                </circle>
            </svg>
            Running
        </span>
        {% elif scan.status == 'COMPLETED' %}
        <span class="status-badge status-completed">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
            </svg>
            Completed
        </span>
        {% elif scan.status == 'CANCELLED' %}
        <span class="status-badge status-cancelled">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
            </svg>
            Cancelled
        </span>
        {% elif scan.status == 'FAILED' %}
        <span class="status-badge status-failed">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
            </svg>
            Failed
        </span>
        {% endif %}
    </td>
    <td>
        <span class="date-text">{{ scan.created_at|date:"M d, Y H:i" }}</span>
    </td>
    <td>
        {% if scan.status == 'COMPLETED' %}
        <span class="results-count">
            {{ scan.results.count }} finding{{ scan.results.count|pluralize }}
        </span>
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td>
        {% if scan.status == 'COMPLETED' %}
        <a href="{% url 'scan_results' scan.id %}" class="btn btn-sm">
            View Results
        </a>
        {% elif scan.status == 'FAILED' %}
        <button
            class="btn btn-sm btn-secondary"
            onclick="showErrorModal({{ scan.id }}, '{{ scan.error_message|escapejs }}')">
            Error Details
        </button>
        {% elif scan.status == 'CANCELLED' %}
        <span class="text-muted">Cancelled{% if scan.cancelled_by %} by {{ scan.cancelled_by.username }}{% endif %}</span>
        {% elif scan.status == 'PENDING' or scan.status == 'RUNNING' %}
        <button
            class="btn btn-sm btn-danger"
            hx-post="{% url 'scan_cancel' scan.id %}"
            hx-swap="outerHTML"
            hx-target="closest tr"
            hx-confirm="Are you sure you want to cancel this scan?">
            Cancel Scan
        </button>
        {% else %}
        <span class="text-muted">In progress...</span>
        {% endif %}
    </td>
</tr>

