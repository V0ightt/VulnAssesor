{% extends 'base.html' %}

{% block title %}{{ form_title }} - VulnAssesor{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h2>{{ form_title }}</h2>
        <a href="{% url 'template_list' %}" class="btn btn-secondary">
            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 0.5rem;">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
            </svg>
            Back to Templates
        </a>
    </div>

    <form method="post" class="template-form" x-data="templateForm()">
        {% csrf_token %}

        <div class="form-group">
            <label for="name">Template Name *</label>
            <input
                type="text"
                id="name"
                name="name"
                value="{{ template.name|default:'' }}"
                placeholder="e.g., Log4j Vulnerability Check"
                required
                maxlength="200"
                class="form-input">
            <p class="form-help">A descriptive name for your template</p>
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea
                id="description"
                name="description"
                rows="3"
                placeholder="Brief description of what this template scans for..."
                class="form-textarea">{{ template.description|default:'' }}</textarea>
            <p class="form-help">Optional: Explain what vulnerabilities this template detects</p>
        </div>

        <div class="form-group">
            <label for="template_content">Template Content (YAML) *</label>
            <div class="editor-toolbar">
                <button type="button" @click="insertSampleTemplate()" class="btn btn-sm">
                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 0.25rem;">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                    Insert Sample Template
                </button>
            </div>
            <textarea
                id="template_content"
                name="template_content"
                rows="20"
                placeholder="Paste your Nuclei YAML template here..."
                required
                class="form-textarea code-editor"
                x-model="content"
                spellcheck="false">{{ template.template_content|default:'' }}</textarea>
            <p class="form-help">
                Valid Nuclei template in YAML format.
                <a href="https://docs.projectdiscovery.io/templates/introduction" target="_blank" rel="noopener noreferrer" style="color: #58a6ff;">
                    Learn more about Nuclei templates
                </a>
            </p>
        </div>

        <div class="form-actions">
            <a href="{% url 'template_list' %}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 0.5rem;">
                    <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                </svg>
                {{ submit_text }}
            </button>
        </div>
    </form>
</div>

<script>
function templateForm() {
    return {
        content: `{{ template.template_content|default:''|escapejs }}`,
        insertSampleTemplate() {
            if (this.content && !confirm('This will replace the current content. Continue?')) {
                return;
            }
            this.content = `id: sample-template
info:
  name: Sample Vulnerability Check
  author: your-name
  severity: medium
  description: A sample template for vulnerability detection
  tags: sample,test

requests:
  - method: GET
    path:
      - "{{BaseURL}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "vulnerable-pattern"
        part: body`;
        }
    }
}
</script>

<style>
.form-container {
    max-width: 900px;
    margin: 0 auto;
}

.form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.form-header h2 {
    margin: 0;
    font-size: 1.75rem;
    color: #c9d1d9;
}

.template-form {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 6px;
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #c9d1d9;
}

.form-input,
.form-textarea {
    width: 100%;
    padding: 0.75rem;
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 6px;
    color: #c9d1d9;
    font-size: 1rem;
    font-family: inherit;
    transition: border-color 0.2s ease;
}

.form-input:focus,
.form-textarea:focus {
    outline: none;
    border-color: #58a6ff;
    box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
}

.code-editor {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    line-height: 1.5;
    tab-size: 2;
}

.form-help {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: #8b949e;
}

.editor-toolbar {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #30363d;
}
</style>
{% endblock %}

